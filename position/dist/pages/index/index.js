;require('./../../runtime');(wx["webpackJsonp"] = wx["webpackJsonp"] || []).push([[3],{

/***/ 3:
/***/ (function(module, exports) {

//index.js
var app = getApp();
Page({
  data: {
    longitude: 113.324520,
    latitude: 23.099994,
    boxDisplay: true,
    repairFeedbackDisplay: false,
    disabled: true,
    timer: "",
    feedbackErea: "",
    submitFeedback: [],
    markers: [{
      iconPath: "../img/greenBus.png",
      id: 0,
      latitude: 30.495214532303866,
      longitude: 114.39670774090536,
      width: 30,
      height: 30
    }],
    // 故障反馈类型
    feedbacks: [{
      name: 'location',
      value: '校车的定位错误；定位与实际位置偏离'
    }, // { name: 'state', value: '校车颜色标示的状态与校车的实际状态不符' },
    {
      name: 'number',
      value: '校车车号不对应'
    }]
  },
  onLoad: function onLoad(options) {
    console.log("onLoad");
    var that = this;
    this.mapCtx = wx.createMapContext('myMap'); //获取当前位置

    wx.getLocation({
      type: 'gcj02',
      //返回可以用于wx.openLocation的经纬度
      success: function success(res) {
        var latitude = res.latitude;
        var longitude = res.longitude;
        that.setData({
          latitude: latitude,
          longitude: longitude
        });
      }
    });
  },
  onReady: function onReady(e) {
    // 请求车辆定位信息
    console.log("onReady");
    var that = this;
    wx.login({
      success: function success(res) {
        if (res.code) {
          var authorizeUrl = app.BASE_URL + '/user/session';
          var authorizeData = {
            code: res.code
          };
          app.request(authorizeUrl, 'POST', authorizeData, function (res) {
            console.log('/user/session');
            console.log(res);
            wx.setStorageSync('token', res.header.Authorization);
            var busPositionUrl = app.BASE_URL + '/bus/all';
            var token = wx.getStorageSync('token');
            that.setData({
              timer: setInterval(function () {
                app.request(busPositionUrl, 'GET', '', function (res) {
                  console.log(res);
                  var getLatitude = res.data.bused[0].position.latitude;
                  var getLongitude = res.data.bused[0].position.longitude.toString();
                  var getId = res.data.bused[0].id;
                  that.setData({
                    markers: [{
                      iconPath: "../img/greenBus.png",
                      id: getId,
                      latitude: getLatitude,
                      longitude: getLongitude,
                      width: 30,
                      height: 30
                    }]
                  });
                  console.log(that.data.markers);
                }, function (res) {}, {
                  'Authorization': token
                }, '');
              }, 2000)
            });
          }, function (res) {}, {
            'content-type': 'application/json'
          }, '');
        }
      }
    });
  },
  onShow: function onShow(e) {
    console.log("onShow");
  },
  // 故障反馈面板是否显示
  repair: function repair() {
    this.setData({
      boxDisplay: false,
      repairFeedbackDisplay: true
    });
  },
  // 获取checkbox的值
  checkboxChange: function checkboxChange(e) {
    this.setData({
      submitFeedback: e.detail.value
    });
  },
  //获取反馈建议texterea的值
  feedbackErea: function feedbackErea(e) {
    this.setData({
      feedbackErea: e.detail.value
    });
  },
  // 提交反馈
  submitFeedback: function submitFeedback(e) {
    var that = this;
    var feedbackData = {
      type: that.data.submitFeedback.toString(),
      text: that.data.feedbackErea
    };
    var token = wx.getStorageSync('token');
    var feedbackUrl = app.BASE_URL + '/feedback';
    app.request(feedbackUrl, 'POST', feedbackData, function (res) {
      console.log('feedbackUrl');
      console.log(res);
      wx.showToast({
        title: '成功',
        icon: 'succes',
        duration: 1000,
        mask: true
      });
      that.setData({
        repairFeedbackDisplay: false,
        boxDisplay: true
      });
    }, function (res) {}, {
      'Authorization': token
    }, '');
  },
  repairFeedbackBox: function repairFeedbackBox() {
    this.setData({
      repairFeedbackDisplay: false,
      boxDisplay: true
    });
  },
  Unload: function Unload() {
    clearInterval(this.data.timer);
  }
});

/***/ })

},[[3,0]]]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWdlcy9pbmRleC9pbmRleC5qcyJdLCJuYW1lcyI6WyJhcHAiLCJnZXRBcHAiLCJQYWdlIiwiZGF0YSIsImxvbmdpdHVkZSIsImxhdGl0dWRlIiwiYm94RGlzcGxheSIsInJlcGFpckZlZWRiYWNrRGlzcGxheSIsImRpc2FibGVkIiwidGltZXIiLCJmZWVkYmFja0VyZWEiLCJzdWJtaXRGZWVkYmFjayIsIm1hcmtlcnMiLCJpY29uUGF0aCIsImlkIiwid2lkdGgiLCJoZWlnaHQiLCJmZWVkYmFja3MiLCJuYW1lIiwidmFsdWUiLCJvbkxvYWQiLCJvcHRpb25zIiwiY29uc29sZSIsImxvZyIsInRoYXQiLCJtYXBDdHgiLCJ3eCIsImNyZWF0ZU1hcENvbnRleHQiLCJnZXRMb2NhdGlvbiIsInR5cGUiLCJzdWNjZXNzIiwicmVzIiwic2V0RGF0YSIsIm9uUmVhZHkiLCJlIiwibG9naW4iLCJjb2RlIiwiYXV0aG9yaXplVXJsIiwiQkFTRV9VUkwiLCJhdXRob3JpemVEYXRhIiwicmVxdWVzdCIsInNldFN0b3JhZ2VTeW5jIiwiaGVhZGVyIiwiQXV0aG9yaXphdGlvbiIsImJ1c1Bvc2l0aW9uVXJsIiwidG9rZW4iLCJnZXRTdG9yYWdlU3luYyIsInNldEludGVydmFsIiwiZ2V0TGF0aXR1ZGUiLCJidXNlZCIsInBvc2l0aW9uIiwiZ2V0TG9uZ2l0dWRlIiwidG9TdHJpbmciLCJnZXRJZCIsIm9uU2hvdyIsInJlcGFpciIsImNoZWNrYm94Q2hhbmdlIiwiZGV0YWlsIiwiZmVlZGJhY2tEYXRhIiwidGV4dCIsImZlZWRiYWNrVXJsIiwic2hvd1RvYXN0IiwidGl0bGUiLCJpY29uIiwiZHVyYXRpb24iLCJtYXNrIiwicmVwYWlyRmVlZGJhY2tCb3giLCJVbmxvYWQiLCJjbGVhckludGVydmFsIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0EsSUFBTUEsR0FBRyxHQUFHQyxNQUFNLEVBQWxCO0FBQ0FDLElBQUksQ0FBQztBQUNIQyxNQUFJ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QkFBcUIsRUFBRSxLQURaO0FBRVhELGtCQUFVLEVBQUU7QUFGRCxPQUFiO0FBSUgsS0FiRCxFQWFHLFVBQUF5QixHQUFHLEVBQUksQ0FBRyxDQWJiLEVBYWU7QUFBRSx1QkFBaUJjO0FBQW5CLEtBYmYsRUFhMkMsRUFiM0M7QUFjRCxHQXpJRTtBQTBJSHFCLG1CQUFpQixFQUFDLDZCQUFVO0FBQzFCLFNBQUtsQyxPQUFMLENBQWE7QUFDWHpCLDJCQUFxQixFQUFFLEtBRFo7QUFFWEQsZ0JBQVUsRUFBRTtBQUZELEtBQWI7QUFJRCxHQS9JRTtBQWdKSDZELFFBQU0sRUFBQyxrQkFBVTtBQUNmQyxpQkFBYSxDQUFDLEtBQUtqRSxJQUFMLENBQVVNLEtBQVgsQ0FBYjtBQUNEO0FBbEpFLENBQUQsQ0FBSixDIiwiZmlsZSI6InBhZ2VzXFxpbmRleFxcaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2luZGV4LmpzXG5jb25zdCBhcHAgPSBnZXRBcHAoKVxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBsb25naXR1ZGU6IDExMy4zMjQ1MjAsXG4gICAgbGF0aXR1ZGU6IDIzLjA5OTk5NCxcblxuICAgIGJveERpc3BsYXk6dHJ1ZSxcbiAgICByZXBhaXJGZWVkYmFja0Rpc3BsYXk6ZmFsc2UsXG5cblxuICAgIGRpc2FibGVkOiB0cnVlLFxuICAgIHRpbWVyOlwiXCIsXG4gICAgZmVlZGJhY2tFcmVhOlwiXCIsXG4gICAgc3VibWl0RmVlZGJhY2s6W10sXG4gIFxuICAgIG1hcmtlcnM6IFtcbiAgICAgIHtcbiAgICAgICAgaWNvblBhdGg6IFwiLi4vaW1nL2dyZWVuQnVzLnBuZ1wiLFxuICAgICAgICBpZDogMCxcbiAgICAgICAgbGF0aXR1ZGU6IDMwLjQ5NTIxNDUzMjMwMzg2NixcbiAgICAgICAgbG9uZ2l0dWRlOiAxMTQuMzk2NzA3NzQwOTA1MzYsXG4gICAgICAgIHdpZHRoOiAzMCxcbiAgICAgICAgaGVpZ2h0OiAzMFxuICAgICAgfVxuICAgIF0sXG4gICAgLy8g5pWF6Zqc5Y+N6aaI57G75Z6LXG4gICAgZmVlZGJhY2tzOiBbXG4gICAgICB7IG5hbWU6ICdsb2NhdGlvbicsIHZhbHVlOiAn5qCh6L2m55qE5a6a5L2N6ZSZ6K+v77yb5a6a5L2N5LiO5a6e6ZmF5L2N572u5YGP56a7J30sXG4gICAgICAvLyB7IG5hbWU6ICdzdGF0ZScsIHZhbHVlOiAn5qCh6L2m6aKc6Imy5qCH56S655qE54q25oCB5LiO5qCh6L2m55qE5a6e6ZmF54q25oCB5LiN56ymJyB9LFxuICAgICAgeyBuYW1lOiAnbnVtYmVyJywgdmFsdWU6ICfmoKHovabovablj7fkuI3lr7nlupQnIH0sXG4gICAgXSxcbiAgXG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBjb25zb2xlLmxvZyhcIm9uTG9hZFwiKVxuICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgdGhpcy5tYXBDdHggPSB3eC5jcmVhdGVNYXBDb250ZXh0KCdteU1hcCcpXG4gICAgLy/ojrflj5blvZPliY3kvY3nva5cbiAgICB3eC5nZXRMb2NhdGlvbih7XG4gICAgICB0eXBlOiAnZ2NqMDInLCAvL+i/lOWbnuWPr+S7peeUqOS6jnd4Lm9wZW5Mb2NhdGlvbueahOe7j+e6rOW6plxuICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgY29uc3QgbGF0aXR1ZGUgPSByZXMubGF0aXR1ZGVcbiAgICAgICAgY29uc3QgbG9uZ2l0dWRlID0gcmVzLmxvbmdpdHVkZVxuICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgIGxhdGl0dWRlOiBsYXRpdHVkZSxcbiAgICAgICAgICBsb25naXR1ZGU6IGxvbmdpdHVkZSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBvblJlYWR5OiBmdW5jdGlvbiAoZSkge1xuICAgIC8vIOivt+axgui9pui+huWumuS9jeS/oeaBr1xuICAgIGNvbnNvbGUubG9nKFwib25SZWFkeVwiKVxuICAgIGNvbnN0IHRoYXQgPSB0aGlzXG5cbiAgICB3eC5sb2dpbih7XG4gICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICBpZiAocmVzLmNvZGUpIHtcbiAgICAgICAgICBsZXQgYXV0aG9yaXplVXJsID0gYXBwLkJBU0VfVVJMICsgJy91c2VyL3Nlc3Npb24nXG4gICAgICAgICAgbGV0IGF1dGhvcml6ZURhdGEgPSB7IGNvZGU6IHJlcy5jb2RlIH1cbiAgICAgICAgICBhcHAucmVxdWVzdChhdXRob3JpemVVcmwsICdQT1NUJywgYXV0aG9yaXplRGF0YSwgcmVzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCcvdXNlci9zZXNzaW9uJylcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCd0b2tlbicsIHJlcy5oZWFkZXIuQXV0aG9yaXphdGlvbilcbiAgICAgICAgICAgIGNvbnN0IGJ1c1Bvc2l0aW9uVXJsID0gYXBwLkJBU0VfVVJMICsgJy9idXMvYWxsJ1xuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSB3eC5nZXRTdG9yYWdlU3luYygndG9rZW4nKVxuICAgICAgICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgICAgICAgdGltZXI6IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAucmVxdWVzdChidXNQb3NpdGlvblVybCwgJ0dFVCcsICcnLCByZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0TGF0aXR1ZGUgPSByZXMuZGF0YS5idXNlZFswXS5wb3NpdGlvbi5sYXRpdHVkZVxuICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0TG9uZ2l0dWRlID0gcmVzLmRhdGEuYnVzZWRbMF0ucG9zaXRpb24ubG9uZ2l0dWRlLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdldElkID0gcmVzLmRhdGEuYnVzZWRbMF0uaWRcbiAgICAgICAgICAgICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uUGF0aDogXCIuLi9pbWcvZ3JlZW5CdXMucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZ2V0SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogZ2V0TGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IGdldExvbmdpdHVkZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMzBcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGF0LmRhdGEubWFya2VycylcbiAgICAgICAgICAgICAgICB9LCByZXMgPT4geyB9LCB7ICdBdXRob3JpemF0aW9uJzogdG9rZW4gfSwgJycpXG4gICAgICAgICAgICAgIH0sIDIwMDApXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0sIHJlcyA9PiB7IH0sIHsgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LCAnJylcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pICBcbiAgfSwgIFxuICBvblNob3c6IGZ1bmN0aW9uIChlKSB7XG4gICAgY29uc29sZS5sb2coXCJvblNob3dcIilcbiAgfSxcbiAgXG4vLyDmlYXpmpzlj43ppojpnaLmnb/mmK/lkKbmmL7npLpcbiAgcmVwYWlyOmZ1bmN0aW9uKCl7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIGJveERpc3BsYXk6IGZhbHNlLFxuICAgICAgcmVwYWlyRmVlZGJhY2tEaXNwbGF5OiB0cnVlLFxuICAgIH0pXG4gIH0sXG4gIC8vIOiOt+WPlmNoZWNrYm9455qE5YC8XG4gIGNoZWNrYm94Q2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzdWJtaXRGZWVkYmFjazogZS5kZXRhaWwudmFsdWVcbiAgICB9KVxuICB9LFxuICAvL+iOt+WPluWPjemmiOW7uuiurnRleHRlcmVh55qE5YC8XG4gIGZlZWRiYWNrRXJlYTogZnVuY3Rpb24gKGUpIHtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgZmVlZGJhY2tFcmVhOiBlLmRldGFpbC52YWx1ZVxuICAgIH0pXG4gIH0sXG4gIC8vIOaPkOS6pOWPjemmiFxuICBzdWJtaXRGZWVkYmFjazpmdW5jdGlvbihlKXtcbiAgICBjb25zdCB0aGF0ID0gdGhpc1xuICAgIGNvbnN0IGZlZWRiYWNrRGF0YSA9IHsgdHlwZTogdGhhdC5kYXRhLnN1Ym1pdEZlZWRiYWNrLnRvU3RyaW5nKCksIHRleHQ6IHRoYXQuZGF0YS5mZWVkYmFja0VyZWF9XG4gICAgY29uc3QgdG9rZW4gPSB3eC5nZXRTdG9yYWdlU3luYygndG9rZW4nKVxuICAgIGNvbnN0IGZlZWRiYWNrVXJsID0gYXBwLkJBU0VfVVJMICsgJy9mZWVkYmFjaydcblxuICAgIGFwcC5yZXF1ZXN0KGZlZWRiYWNrVXJsLCAnUE9TVCcsIGZlZWRiYWNrRGF0YSwgcmVzID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdmZWVkYmFja1VybCcpXG4gICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+aIkOWKnycsXG4gICAgICAgICAgICBpY29uOiAnc3VjY2VzJyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLFxuICAgICAgICAgICAgbWFzazp0cnVlXG4gICAgICAgIH0pXG4gICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgcmVwYWlyRmVlZGJhY2tEaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICBib3hEaXNwbGF5OiB0cnVlLFxuICAgICAgICB9KVxuICAgIH0sIHJlcyA9PiB7IH0sIHsgJ0F1dGhvcml6YXRpb24nOiB0b2tlbiB9LCAnJylcbiAgfSxcbiAgcmVwYWlyRmVlZGJhY2tCb3g6ZnVuY3Rpb24oKXtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgcmVwYWlyRmVlZGJhY2tEaXNwbGF5OiBmYWxzZSxcbiAgICAgIGJveERpc3BsYXk6IHRydWUsXG4gICAgfSlcbiAgfSxcbiAgVW5sb2FkOmZ1bmN0aW9uKCl7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmRhdGEudGltZXIpXG4gIH1cbn0pXG4iXSwic291cmNlUm9vdCI6IiJ9